{% comment %}
Because the "bar" visualization is basic, nothing special needs to be done here,
apart from providing the canvas tag. For details on the Chart.js configuration
being used, see `createPlot()` in `indicatorView.js`.
{% endcomment %}
<canvas></canvas>
{% if meta.graph_min_value and meta.graph_max_value %}
  <script>
    opensdg.chartConfigAlter = function(config) {
      var overrides = {
        options: {
          scales: {
            yAxes: [{
              ticks: {
                min: {{ meta.graph_min_value }},
                max: {{ meta.graph_max_value }}
              }
            }]
          }
        }
      }
      // Add these overrides onto the normal config, and return it.
      $.extend(true, config, overrides);
      return config;
    }
  </script>
{% endif %}


{% if meta.stackedBar %}
  <script>
    opensdg.chartConfigAlter = function(config) {
      var overrides = {
        options: {
          scales: {
            xAxes: [{
              stacked: true,
            }],
            yAxes: [{
              stacked: true,
            }]
          }
        }
      }

      // If we have stackedDisaggregation, we need to group datasets into stacks.
      config.data.datasets.forEach(function(dataset) {
        var disaggregation = $.extend({}, dataset.disaggregation);
        if (info.stackedDisaggregation) {
          // We don't want the stackedDisaggregation to be considered when stacking.
          delete disaggregation[info.stackedDisaggregation];
        }
        // Use the disaggregation as a unique id for each stack.
        dataset.stack = JSON.stringify(disaggregation);
      });
      
      // Add these overrides onto the normal config, and return it.
      $.extend(true, config, overrides);
      return config;
    }
  </script>
{% endif %}
